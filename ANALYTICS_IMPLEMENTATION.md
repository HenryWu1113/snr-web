# 統計分析系統功能總結與未來規劃 🚀

本文檔總結了目前的交易統計分析系統功能，並為未來的進階分析功能提供開發指引。

## ✅ 目前已完成功能 (Current Features)

### 1. 核心分析頁面
- **總覽頁面 (Overview)** `/analytics`
  - **績效趨勢圖**：支援切換「R 倍數」與「損益金額」，視覺化累積表現。
  - **關鍵指標卡片**：總交易次數、勝率、平均 R 倍數、總損益，具備紅綠顏色標示（正向/負向）。
  - **預設時間範圍**：自動設定為過去 365 天，提供長期視角。
  - **快速導航**：連結至各維度詳細分析頁面。

- **多維度詳細分析**
  - **商品分析** `/analytics/commodity`
  - **交易類型分析** `/analytics/trade-type`
  - **時間框架分析** `/analytics/timeframe`
  - **趨勢線類型分析** `/analytics/trendline`
  - **做多/做空分析** `/analytics/position`
  - **進場類型分析** `/analytics/entry-type` (支援多對多關係)

### 2. 數據視覺化與互動
- **圖表系統**：
  - **勝率柱狀圖**：使用 Emerald (綠) / Rose (紅) 區分高低勝率。
  - **R 倍數/損益柱狀圖**：雙色柱狀圖（總計/平均），使用 Sky/Violet 配色。
  - **分佈圓餅圖**：顯示各分組的交易佔比。
- **表格數據**：詳細列出交易次數、勝率、平均獲利、最大回撤等數據。
- **互動功能**：
  - **日期範圍選擇器**：支援預設區間（本週、本月等）與自訂區間。
  - **暗色模式支援**：全站圖表與 UI 皆優化 Dark Mode 顯示效果。

### 3. 技術架構
- **後端 API**：`src/app/api/analytics/route.ts` 支援多維度聚合查詢與關聯數據加載。
- **統計邏輯**：`src/lib/stats.ts` 封裝核心統計算法，支援一對一與多對多（如進場類型）關係統計。
- **組件化設計**：複用 `DimensionAnalysisContent`, `DimensionCharts`, `DimensionTable` 等組件，保持界面一致性。

---

## 🔮 未來進階分析規劃 (Advanced Analytics Roadmap)

以下功能旨在提供更深度的市場洞察與策略優化，建議在下一階段開發中優先考慮。

### 1. 複合式篩選與分析 (Advanced Filtering & Composite Analysis)
目前系統僅支援單一維度的分組分析。未來的核心目標是實現「多條件交叉篩選」。

- **多重篩選器 (Multi-Filter System)**：
  - 允許使用者同時設定多個篩選條件。
  - *範例*：「只顯示 **黃金 (XAUUSD)** 在 **15分鐘圖** 上使用 **突破策略** 的 **做多** 交易」。
  - **技術實現**：更新 API 接收多個 filter 參數，動態構建 Prisma `where` 查詢。

- **交叉分析矩陣 (Cross-Analysis Matrix / Heatmap)**：
  - **功能**：以熱力圖形式展示兩個維度的交叉表現。
  - *範例*：X 軸為「時間框架」，Y 軸為「商品」，格子顏色深淺代表「勝率」或「總損益」。
  - **目的**：快速找出「哪個商品在哪個時間框架下表現最好」。

### 2. 進階交易績效指標 (Advanced Performance Metrics)
- **MAE / MFE 分析**：
  - **MFE (Maximum Favorable Excursion)**：最大有利偏移，分析行情最大跑了多少 R，幫助優化止盈。
  - **MAE (Maximum Adverse Excursion)**：最大不利偏移，分析行情最大反向多少 R，幫助優化止損。
  - **圖表**：散點圖 (Scatter Plot)，X 軸為 MFE，Y 軸為 MAE。

- **累積績效模擬 (Equity Curve Simulator)**：
  - **功能**：基於現有交易數據，模擬不同資金管理策略（如固定百分比風險、固定金額風險）下的資金成長曲線。
  - **蒙地卡羅模擬 (Monte Carlo Simulation)**：隨機重組交易順序，評估策略在最壞情況下的最大回撤 (Max Drawdown)。

### 3. 行為與心理分析 (Behavioral & Psychological Analysis)
- **自定義標籤系統 (Tagging System)**：
  - 允許使用者為交易添加任意標籤（如 `#追單`, `#情緒差`, `#重倉`, `#完美執行`）。
  - **標籤分析**：統計帶有特定標籤的交易績效，量化心理因素對交易的影響。

- **交易時段分析 (Session Analysis)**：
  - 自動判斷交易發生的時段（亞洲盤、倫敦盤、紐約盤）。
  - 分析不同時段的波動性與策略勝率。

- **持倉時間分析 (Holding Time Analysis)**：
  - 分析持倉時間長短與損益的關係（例如：持倉超過 4 小時的交易是否更容易虧損？）。

### 4. 報表與導出 (Reporting & Export)
- **PDF/Excel 導出**：一鍵生成包含圖表與詳細數據的交易報告，方便存檔或分享。
- **每週/每月回顧視圖**：自動生成週期性檢討報告，列出本週最佳/最差交易及改進建議。

### 5. 開發建議 (Development Guidelines)
- **資料庫優化**：隨著篩選條件變複雜，需注意 Prisma 查詢效能，必要時建立適當的索引。
- **前端狀態管理**：複合式篩選需要管理較複雜的狀態，建議使用 URL Search Params 來保存篩選狀態，方便分享連結。
- **圖表庫選擇**：目前的 `recharts` 足以應付大多數需求，但對於熱力圖或複雜散點圖，可能需要評估是否引入更專業的圖表庫（如 Nivo 或 Visx）。
